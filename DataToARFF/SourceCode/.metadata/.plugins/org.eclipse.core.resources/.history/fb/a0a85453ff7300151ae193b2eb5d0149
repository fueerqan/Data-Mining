package com.portalbisnisbersama;

import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.FileOutputStream;
import java.io.IOException;

import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.Timer;

public class ProsesKonversi {
	JFrame frame;
	BacaFile baca;
	
	Timer time;
	
	JLabel labelTitle = new JLabel();
	JLabel labelPersen = new JLabel();
		
	String judul, attrData, attrHasil, pathData, pathSimpan;
	String urutan = "";
	int jumlahBaris;
	int barisSekarang;
	boolean data = false;
	
	String isiLabelKomen = "Membuat Komentar pada File";
	String isiLabelTitle = "Membuat Title file ARFF";
	String isiLabelAttribute = "Membuat Attribute file ARFF";
	String isiLabelData = "Mengisi data ke file ARFF";
	
	/*Bawaan*/
	String comment;
	String bawaJudul = "@RELATION ";
	String bawaAttr = "@ATTRIBUTE ";
	String bawaData = "@DATA";
		
	/**
	 * Constructor dari class ProsesKonversi
	 */
	public ProsesKonversi() {
		// TODO Auto-generated constructor stub
		baca = new BacaFile();
		
		buatFrame();
	}
	
	/**
	 * Fungsi untuk membuat frame dan isi komponennya
	 */
	public void buatFrame()
	{
		frame = new JFrame("DataToARFF - Muhammad Furqan");
		frame.setSize(200, 200);
		frame.setLocationRelativeTo(null);
		
		komponen();
		
		frame.setVisible(true);
	}
	
	/**
	 * Fungsi untuk mengubah angka di bagian persen ketika sedang menyalin data
	 */
	private void ubahPersen()
	{
		ActionListener gerakPersen = new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent arg0) {
				// TODO Auto-generated method stub
				int persen = (barisSekarang * 100) / jumlahBaris;
				labelPersen.setText(Integer.toString(persen));
				
				if( ! data)
				{
					time.stop();
				}
			}
		};
		
		if(data)
		{
			time = new Timer(1, gerakPersen);
			time.start();
		}
	}
	
	/**
	 * Fungsi untuk mengatur komponen dalam frame
	 */
	public void komponen()
	{
		JPanel panel = (JPanel) frame.getContentPane();
		panel.setLayout(new GridLayout(2,1));
		
		panel.add(labelTitle);
		panel.add(labelPersen);
	}
	
	/**
	 * Fungsi untuk set judul data
	 * 
	 * @param judul
	 */
	public void setJudul(String judul)
	{
		this.judul = judul;
	}
	
	/**
	 * Fungsi untuk set attribute data
	 * @param attr
	 */
	public void setAttrData(String attr)
	{
		this.attrData = attr;
	}
	
	/**
	 * Fungsi untuk set attribute hasil
	 * @param attr
	 */
	public void setAttrHasil(String attr)
	{
		this.attrHasil = attr;
	}
	
	/**
	 * Fungsi untuk set lokasi data
	 * @param path
	 */
	public void setPathData(String path)
	{
		this.pathData = path;
		
		/*set path dan buka file*/
		baca.setPath(pathData);
		baca.buka();
	}
	
	/**
	 * Fungsi untuk set dimana data disimpan
	 * @param path
	 */
	public void setPathSimpan(String path)
	{
		this.pathSimpan = path;
	}
	
	/**
	 * Fungsi untuk menulis jumlah baris
	 * @param baris
	 */
	public void setJumlahBaris(int baris)
	{
		this.jumlahBaris = baris;
	}
	
	/**
	 * Fungsi untuk mendapatkan urutan data dan attribute di dalam file arff nanti
	 */
	public void aturUrutan()
	{
		String[] bagiAttrHasil = attrHasil.split("\n");
		String[] bagiAttrData = attrData.split("\n");
		
		for(int i = 0; i < bagiAttrHasil.length; i++)
		{
			for(int j = 0; j < bagiAttrData.length; j++)
			{
				if(bagiAttrData[j].compareTo(bagiAttrHasil[i]) == 0)
				{
					urutan += j;
					if(i < bagiAttrHasil.length - 1)
						urutan += ",";
				}
			}
		}
	}
	
	/**
	 * Fungsi untuk membuat file arff
	 */
	public void simpanFile()
	{
		comment = "% 1. Title : " + judul + "\n%\n% 2. Sources : \n%\n% 3. Created using DataToARFF - Muhammad Furqan's Application.\n%\n%\n";
		
		int i=0;
        try{
            FileOutputStream filesave = new FileOutputStream(pathSimpan);
            
            /*cetak comment*/
            labelTitle.setText(isiLabelKomen);
            for(i = 0; i < comment.length(); i++)
            {
            	filesave.write(comment.charAt(i));
            }
            
            /*cetak bawaan judul*/
            labelTitle.setText(isiLabelTitle);
            for(i = 0; i < bawaJudul.length(); i++)
            {
            	filesave.write(bawaJudul.charAt(i));
            }
            
            /*cetak judul*/
            for(i = 0; i < judul.length(); i++)
            {
            	filesave.write(judul.charAt(i));
            }
            
            /*cetak baris baru*/
            filesave.write('\n');
            filesave.write('\n');
            
            /*cetak attribute*/
            labelTitle.setText(isiLabelAttribute);
            String[] attribute = attrHasil.split("\n");
            for(i = 0; i < attribute.length; i++)
            {
            	
            	/*cetak penanda attributenya*/
            	for(int j = 0; j < bawaAttr.length(); j++)
            	{
            		filesave.write(bawaAttr.charAt(j));
            	}
            	
            	/*cetak nama attributenya*/
            	for(int j = 0; j < attribute[i].length(); j++)
            	{
            		filesave.write(attribute[i].charAt(j));
            	}
            	
            	/*cetak baris baru*/
                filesave.write('\n');
            }
            
            /*cetak baris baru*/
            filesave.write('\n');
            filesave.write('\n');
            
            /*cetak penanda data*/
            labelTitle.setText(isiLabelData);
            data = true;
            for(i = 0; i < bawaData.length(); i++)
            {
            	filesave.write(bawaData.charAt(i));
            }
            /*cetak baris baru*/
            filesave.write('\n');
            
            String isiData;
            while((isiData = baca.lanjut(urutan)) != "")
            {
            	barisSekarang = baca.getBarisSekarang();
            	for(i = 0; i < isiData.length(); i++)
            	{
            		filesave.write(isiData.charAt(i));
            	}
            }
            
            data = false;
            
            filesave.close(); /*tutup file hasil*/
            baca.tutup(); /*tutup file data*/
        }catch(IOException errorSimpanFile){
            JOptionPane.showMessageDialog(frame, "File gagal disimpan");
        }
	}
	
	private void tutupAplikasi()
	{
		JOptionPane.showMessageDialog(frame, "Data berhasil di konversi ke format ARFF");
		frame.setVisible(false);
		System.exit(1);
	}
}